<?xml version="1.0" encoding="UTF-8"?>
<mod name="Actions Mods" version="1.0" author="Martyx" contact="martyx@otland.net" enabled="yes">
	<!-- Action Annihilator I -->
	<action uniqueid="60018" override="yes" event="script"><![CDATA[
		local config = {
			level = 100,
			storage = 60018,

			-- Player positions to players
			entry = {
				{x = 973, y = 1068, z = 9},
				{x = 974, y = 1068, z = 9},
				{x = 975, y = 1068, z = 9},
				{x = 976, y = 1068, z = 9}
			},

			-- New positions to players
			destination = {
				{x = 1229, y = 1048, z = 10},
				{x = 1230, y = 1048, z = 10},
				{x = 1231, y = 1048, z = 10},
				{x = 1232, y = 1048, z = 10}
			},

			-- Position of monsters
			monsters = {
				{{x = 1229, y = 1046, z = 10}, "demon fire"},
				{{x = 1231, y = 1046, z = 10}, "demon fire"},
				{{x = 1233, y = 1048, z = 10}, "demon fire"},
				{{x = 1234, y = 1048, z = 10}, "demon fire"},
				{{x = 1230, y = 1050, z = 10}, "demon fire"},
				{{x = 1232, y = 1050, z = 10}, "demon fire"}
			}
		}

		function onUse(cid, item, fromPosition, itemEx, toPosition)
			if(item.itemid == 1946) then
				doTransformItem(item.uid, item.itemid - 1)
				return true
			end

			if(item.itemid ~= 1945) then
				return true
			end

			local players = {}
			for _, position in ipairs(config.entry) do
				local pid = getTopCreature(position).uid
				if(pid == 0 or not isPlayer(pid) or getCreatureStorage(pid, config.storage) > 0 or getPlayerLevel(pid) < config.level) then
					doPlayerSendDefaultCancel(cid, RETURNVALUE_NOTPOSSIBLE)
					return true
				end

				table.insert(players, pid)
			end

			for i, pid in ipairs(players) do
				doSendMagicEffect(config.entry[i], CONST_ME_POFF)
				doTeleportThing(pid, config.destination[i], false)
				doSendMagicEffect(config.destination[i], CONST_ME_ENERGYAREA)
			end

			for m, monster in pairs(config.monsters) do
				local creature = getTopCreature(monster[1]).uid
				if(creature > 0 and not isPlayer(creature)) then
					doRemoveCreature(creature)
				end

				doCleanTile(monster[1])
				doCreateMonster(monster[2], monster[1])
			end

			doTransformItem(item.uid, item.itemid + 1)
			return true
		end
	]]></action>

	<!-- Action Annihilator II -->
	<action uniqueid="30017" override="yes" event="script"><![CDATA[
		local config = {
			level = 100,
			storage = 30017,

			-- Player positions to players
			entry = {
				{x = 743, y = 731, z = 9},
				{x = 748, y = 733, z = 9},
				{x = 750, y = 728, z = 9},
				{x = 745, y = 726, z = 9}
			},

			-- New positions to players
			destination = {
				{x = 645, y = 607, z = 12},
				{x = 645, y = 610, z = 12},
				{x = 645, y = 613, z = 12},
				{x = 645, y = 616, z = 12}
			},

			-- Position of monsters
			monsters = {
				{{x = 645, y = 605, z = 12}, "Tyrant Warrior"},
				{{x = 645, y = 606, z = 12}, "Tyrant Warrior"},
				{{x = 646, y = 610, z = 12}, "Tyrant Warrior"},
				{{x = 647, y = 610, z = 12}, "Tyrant Warrior"},
				{{x = 644, y = 613, z = 12}, "Tyrant Warrior"},
				{{x = 643, y = 613, z = 12}, "Tyrant Warrior"},
				{{x = 645, y = 617, z = 12}, "Tyrant Warrior"},
				{{x = 645, y = 618, z = 12}, "Tyrant Warrior"},

				-- Extras
				{{x = 642, y = 606, z = 12}, "Tyrant Warrior"},
				{{x = 648, y = 606, z = 12}, "Tyrant Warrior"},
				{{x = 642, y = 610, z = 12}, "Tyrant Warrior"},
				{{x = 648, y = 613, z = 12}, "Tyrant Warrior"},
				{{x = 642, y = 617, z = 12}, "Tyrant Warrior"},
				{{x = 648, y = 617, z = 12}, "Tyrant Warrior"}
			}
		}

		function onUse(cid, item, fromPosition, itemEx, toPosition)
			if(item.itemid == 1946) then
				doTransformItem(item.uid, item.itemid - 1)
				return true
			end

			if(item.itemid ~= 1945) then
				return true
			end

			local players = {}
			for _, position in ipairs(config.entry) do
				local pid = getTopCreature(position).uid
				if(pid == 0 or not isPlayer(pid) or getCreatureStorage(pid, config.storage) > 0 or getPlayerLevel(pid) < config.level) then
					doPlayerSendDefaultCancel(cid, RETURNVALUE_NOTPOSSIBLE)
					return true
				end

				table.insert(players, pid)
			end

			for i, pid in ipairs(players) do
				doSendMagicEffect(config.entry[i], CONST_ME_POFF)
				doTeleportThing(pid, config.destination[i], false)
				doSendMagicEffect(config.destination[i], CONST_ME_ENERGYAREA)
			end

			for m, monster in pairs(config.monsters) do
				local creature = getTopCreature(monster[1]).uid
				if(creature > 0 and not isPlayer(creature)) then
					doRemoveCreature(creature)
				end

				doCleanTile(monster[1])
				doCreateMonster(monster[2], monster[1])
			end

			doTransformItem(item.uid, item.itemid + 1)
			return true
		end
	]]></action>

	<!-- Action Annihilator III -->
	<action uniqueid="30016" override="yes" event="script"><![CDATA[
		local config = {
			level = 100,
			storage = 30016,

			-- Player positions to players
			entry = {
				{x = 1474, y = 376, z = 8},
				{x = 1474, y = 379, z = 8},
				{x = 1474, y = 383, z = 8},
				{x = 1474, y = 386, z = 8}
			},

			-- New positions to players
			destination = {
				{x = 1290, y = 1048, z = 10},
				{x = 1298, y = 1042, z = 10},
				{x = 1298, y = 1054, z = 10},
				{x = 1306, y = 1048, z = 10}
			}
		}

		function onUse(cid, item, fromPosition, itemEx, toPosition)
			if(item.itemid == 1946) then
				doTransformItem(item.uid, item.itemid - 1)
				return true
			end

			if(item.itemid ~= 1945) then
				return true
			end

			local players = {}
			for _, position in ipairs(config.entry) do
				local pid = getTopCreature(position).uid
				if(pid == 0 or not isPlayer(pid) or getCreatureStorage(pid, config.storage) > 0 or getPlayerLevel(pid) < config.level) then
					doPlayerSendDefaultCancel(cid, RETURNVALUE_NOTPOSSIBLE)
					return true
				end

				table.insert(players, pid)
			end

			for i, pid in ipairs(players) do
				doSendMagicEffect(config.entry[i], CONST_ME_POFF)
				doTeleportThing(pid, config.destination[i], false)
				doSendMagicEffect(config.destination[i], CONST_ME_ENERGYAREA)
			end

			doTransformItem(item.uid, item.itemid + 1)
			return true
		end
	]]></action>
</mod>
